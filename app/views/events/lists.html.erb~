<script>
var ajax = false;
var valoffset = 0;
var filter = 0;

$(document).ready(
	function(){
		$('.filter').click (select);
});

function select(){
	if(ajax){
		return;
	}
	filter = (this).getAttribute("alt");
	valoffset = 0;
	$('.event_list').empty();
	ajax_call();
}

function ajax_call(){
	putImage();
	$.ajax({ url: 'refreshList/'+valoffset+'/'+filter, 
		success: function(data) {					   
			$('.event_list').append(data);
			removeImage();			    
		}
	});
}

function putImage(){
	ajax = true;
	$('#img-cont').append('<img src="<%= asset_path 'ajax-loader.gif' %>" class="ajax-wait" >');
}

function removeImage(){
	ajax = false;
	$('.ajax-wait').remove();
}

$(window).scroll(function(){
	if(ajax){
		return;
	}
	if  ($(window).scrollTop() == $(document).height() - $(window).height()){			
		if(valoffset < <%= Event.count %>){						
			valoffset = valoffset + 10;						
		ajax_call();			   
	}			  
}
			
});
</script>

<div class="category_nav">
  <% Tag.all.each do |tag|%>
 
  <a alt="<%=tag.id%>" class="filter"><%=t('tags.'+ tag.name)%></a> |
  
  <% end %>
  
</div>


<div class="event_list" >
<% @events.each do |event|  %>



<div class="listObject">
	
   <div class="photo">
   	<% if event.picture %>
   	<%= image_tag event.picture %>
   	<%else %>
   	<%= image_tag "event_standar.png"%>
   	<%end%>
	
	</div>
	
	<div class="title">
	<%= link_to event.name, event %>
	</div>
	
	<div class="date">
	<% if event.start_time %>
	<%= Time.at(event.start_time).strftime(t('time.formats.short')) %>
	<%end %> |
	<% if event.end_time %>
	<%= Time.at(event.end_time).strftime(t('time.formats.short')) %> 
	<%end %>
	</div>
	
	
	</div>



<% end %>

</div>


<% content_for :left do %>

<div class="list_cat">

</div>

<% end %>




